{% extends 'base.html' %}
{% block header %}
<h1 xmlns="">{% block title %}Tables{% endblock %}</h1>
{% endblock %}

{% block content %}


<body>
<script type="text/javascript" src="{{ url_for('static', filename='jquery-3.3.1.min.js') }}"> </script>

<script type="text/javascript" src="{{ url_for('static', filename='vis.js') }}"></script>

<style type="text/css">
    #mynetwork {
      width: 600px;
      height: 400px;
      border: 1px solid lightgray;
    }
  </style>
<p>
  Simple network with edges and nodes. Double click to add node.
  <input type="hidden" id='direction' value="LR">
</p>

<div id="mynetwork"></div>
<pre id="eventSpan"></pre>


<script type="text/javascript">
  // create an array with nodes
  var nodes = new vis.DataSet([
    {% for table in tables %}
      {id: {{table.id}}, label: '{{ table.object }}' },
    {% endfor %}
  ]);

  // create an array with edges
  var edges = new vis.DataSet([
    {% for edge in edges %}
      {from: {{edge.from_table_id}}, to: '{{ edge.to_table_id}}', arrows:'to'},
    {% endfor %}
  ]);

  // create a network
  var container = document.getElementById('mynetwork');
  var data = {
    nodes: nodes,
    edges: edges
  };
  var directionInput = document.getElementById("direction").value;
  var options = {
    interaction:{keyboard: {enabled: true }, navigationButtons: true, hover:true }
    ,manipulation: {enabled: true, addNode: true, initiallyActive: true}
    ,layout: {
              hierarchical: {
              enabled: true,
              direction: directionInput,
              sortMethod: 'directed'
              }
    }
  };
  var network = new vis.Network(container, data, options);

network.on('doubleClick',function(params){
    if((params.nodes.length == 0) && (params.edges.length == 0)) {
        var plabel = prompt("Enter name of new node","");
        var updatedIds = nodes.add([{
            label:plabel,
            x:params.pointer.canvas.x,
            y:params.pointer.canvas.y
        }]);
        network.selectNodes([updatedIds[0]]);
        network.editNode();
    }
    params.preventDefault();
})

 <!--network.on("click", function (params) {-->
        <!--params.event = "[original event]";-->
        <!--document.getElementById('eventSpan').innerHTML = '<h2>Click event:</h2>' + JSON.stringify(params, null, 4);-->
        <!--console.log('click event, getNodeAt returns: ' + this.getNodeAt(params.pointer.DOM));-->
    <!--});-->
    <!--&lt;!&ndash;network.on("doubleClick", function (params) {&ndash;&gt;-->
        <!--&lt;!&ndash;params.event = "[original event]";&ndash;&gt;-->
        <!--&lt;!&ndash;document.getElementById('eventSpan').innerHTML = '<h2>doubleClick event:</h2>' + JSON.stringify(params, null, 4);&ndash;&gt;-->
    <!--&lt;!&ndash;});&ndash;&gt;-->
    <!--network.on("oncontext", function (params) {-->
        <!--params.event = "[original event]";-->
        <!--document.getElementById('eventSpan').innerHTML = '<h2>oncontext (right click) event:</h2>' + JSON.stringify(params, null, 4);-->
    <!--});-->
    <!--network.on("dragStart", function (params) {-->
        <!--// There's no point in displaying this event on screen, it gets immediately overwritten-->
        <!--params.event = "[original event]";-->
        <!--console.log('dragStart Event:', params);-->
        <!--console.log('dragStart event, getNodeAt returns: ' + this.getNodeAt(params.pointer.DOM));-->
    <!--});-->
    <!--network.on("dragging", function (params) {-->
        <!--params.event = "[original event]";-->
        <!--document.getElementById('eventSpan').innerHTML = '<h2>dragging event:</h2>' + JSON.stringify(params, null, 4);-->
    <!--});-->
    <!--network.on("dragEnd", function (params) {-->
        <!--params.event = "[original event]";-->
        <!--document.getElementById('eventSpan').innerHTML = '<h2>dragEnd event:</h2>' + JSON.stringify(params, null, 4);-->
        <!--console.log('dragEnd Event:', params);-->
        <!--console.log('dragEnd event, getNodeAt returns: ' + this.getNodeAt(params.pointer.DOM));-->
    <!--});-->
    <!--network.on("zoom", function (params) {-->
        <!--document.getElementById('eventSpan').innerHTML = '<h2>zoom event:</h2>' + JSON.stringify(params, null, 4);-->
    <!--});-->
    <!--network.on("showPopup", function (params) {-->
        <!--document.getElementById('eventSpan').innerHTML = '<h2>showPopup event: </h2>' + JSON.stringify(params, null, 4);-->
    <!--});-->
    <!--network.on("hidePopup", function () {-->
        <!--console.log('hidePopup Event');-->
    <!--});-->
    <!--network.on("select", function (params) {-->
        <!--console.log('select Event:', params);-->
    <!--});-->
    <!--network.on("selectNode", function (params) {-->
        <!--console.log('selectNode Event:', params);-->
    <!--});-->
    <!--network.on("selectEdge", function (params) {-->
        <!--console.log('selectEdge Event:', params);-->
    <!--});-->
    <!--network.on("deselectNode", function (params) {-->
        <!--console.log('deselectNode Event:', params);-->
    <!--});-->
    <!--network.on("deselectEdge", function (params) {-->
        <!--console.log('deselectEdge Event:', params);-->
    <!--});-->
    <!--network.on("hoverNode", function (params) {-->
        <!--console.log('hoverNode Event:', params);-->
    <!--});-->
    <!--network.on("hoverEdge", function (params) {-->
        <!--console.log('hoverEdge Event:', params);-->
    <!--});-->
    <!--network.on("blurNode", function (params) {-->
        <!--console.log('blurNode Event:', params);-->
    <!--});-->
    <!--network.on("blurEdge", function (params) {-->
        <!--console.log('blurEdge Event:', params);-->
    <!--});-->

</script>
<script type=text/javascript>
  $SCRIPT_ROOT = {{ request.script_root|tojson|safe }};
</script>

<script type=text/javascript>
  $(function() {
    $('#send').bind('click', function() {
      $.getJSON($SCRIPT_ROOT + '/_add_numbers', {
        c: JSON.stringify(nodes.get(), null, 4)
      }, function(data) {
        $("#result").text(data.result);
      });
      return false;
    });
  });
</script>
<h1>Click "save" to save nodes to database</h1>
<button id="send">Save</button>
<p id="result">

<p>
</body>

{% endblock %}